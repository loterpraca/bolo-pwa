<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Sistema de Bol√µes</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#4f46e5">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root{
      --primary:#6366f1;--primary-dark:#4f46e5;--primary-light:#818cf8;--secondary:#f59e0b;
      --bg:#f8fafc;--card:#fff;--txt:#0f172a;--muted:#64748b;--label:#334155;--line:#e2e8f0;
      --success:#10b981;--danger:#ef4444;--warning:#f59e0b;
      --shadow:0 10px 25px rgba(0,0,0,.08);--shadow-lg:0 20px 50px rgba(0,0,0,.12);
      --radius:16px;--radius-sm:12px;--pad:7px;
      --font:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      --transition:all .25s cubic-bezier(.4,0,.2,1);
    }

    [data-theme="boulevard"]{--primary:#4682B4;--primary-dark:#2563eb;--primary-light:#60a5fa;--secondary:#f97316;}
    [data-theme="centro"]{--primary:#2E8B57;--primary-dark:#16a34a;--primary-light:#4ade80;--secondary:#eab308;}
    [data-theme="lotobel"]{--primary:#CD5C5C;--primary-dark:#b91c1c;--primary-light:#ef4444;--secondary:#d97706;}
    [data-theme="santa-tereza"]{--primary:#483D8B;--primary-dark:#7e22ce;--primary-light:#a855f7;--secondary:#f59e0b;}

    *{box-sizing:border-box;margin:0;padding:0}
    body{margin:0;font-family:var(--font);color:var(--txt);background:var(--bg);min-height:100vh;transition:var(--transition)}

    /* HEADER compacto + avatar circular */
    .header{
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      color:#fff;padding:10px 12px;box-shadow:var(--shadow);
      position:sticky;top:0;z-index:100;
    }
    .header-content{max-width:920px;margin:0 auto;display:flex;align-items:center;gap:12px}

    /* Logo circular (estilo Google) */
    .logo-container{
      width:58px;height:58px;background:#fff;border-radius:50%;
      padding:0;box-shadow:0 6px 16px rgba(0,0,0,.18);
      display:flex;align-items:center;justify-content:center;overflow:hidden;flex:0 0 auto
    }
    .logo-container img{
      width:122%;height:122%;
      object-fit:cover;object-position:center;
    }

    .header-title{flex:1;min-width:0}
    .header-title h1{
      font-size:17px;font-weight:900;line-height:1.05;margin:0 0 2px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis
    }
    .header-title p{
      font-size:12px;opacity:.9;margin:0;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis
    }

    /* 4 logos topo */
    .brand-logos{display:flex;gap:8px;align-items:center;justify-content:flex-end;flex:0 0 auto}
    .brand-logos button{
      border:0;background:rgba(255,255,255,.14);
      width:34px;height:34px;border-radius:12px;display:grid;place-items:center;cursor:pointer;
      transition:var(--transition);padding:0
    }
    .brand-logos button:hover{transform:translateY(-1px);background:rgba(255,255,255,.22)}
    .brand-logos button.active{outline:2px solid rgba(255,255,255,.55);background:rgba(255,255,255,.24)}
    .brand-logos img{width:34px;height:34px;object-fit:contain;filter:drop-shadow(0 1px 2px rgba(0,0,0,.15))}

    .wrap{max-width:920px;margin:0 auto;padding:0px 12px 30px}

    .card{
      background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:var(--pad);margin:4px 4;transition:var(--transition)
    }
    .card:hover{box-shadow:var(--shadow-lg);transform:translateY(-1px)}

    .section-header{
      display:flex;align-items:center;gap:10px;margin-bottom:4px;padding-bottom:4px;border-bottom:1px solid var(--primary)
    }
    .section-icon{
      width:26px;height:26px;border-radius:8px;
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      display:flex;align-items:center;justify-content:center;font-size:16px;color:#fff;flex:0 0 auto
    }
    .section-title{
      font-size:14px;font-weight:800;margin:4;color:var(--txt);
      display:flex;align-items:center;gap:10px;flex-wrap:wrap
    }

    /* ‚úÖ MOVIMENTAR: texto alinhado ao lado do √≠cone */
    .section-title.inline-title{align-items:center;}

    /* GRIDS */
    .grid-1{display:grid;grid-template-columns:1fr;gap:12px}
    .grid-2{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:12px;margin-top:12px}

    /* ‚úÖ for√ßa 2 colunas mesmo no celular (para MOVIMENTA√á√ÉO) */
    .force-2{grid-template-columns:minmax(0,1fr) minmax(0,1fr)!important}

    .field label{
      display:flex;align-items:center;gap:4px;font-size:11px;color:var(--label);
      font-weight:800;margin:0 0 6px 2px
    }
    .field label i{color:var(--primary);font-size:13px}
    .field input,.field select{
      width:100%;font-size:13px;padding:6px 7px;border-radius:var(--radius-sm);
      border:2px solid var(--line);outline:none;background:#fff;transition:var(--transition);font-family:var(--font)
    }
    .field input:focus,.field select:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(99,102,241,.10);transform:translateY(-1px)}
    .field input:disabled{background:#f1f5f9;color:#94a3b8;cursor:not-allowed;opacity:.75}

    /* Chip origem */
    .mov-origem{
      display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
      background:rgba(0,0,0,.06);color:var(--txt);font-size:12px;font-weight:900;
      border:1px solid var(--line)
    }
    .mov-origem i{color:var(--primary)}

    /* A√ß√µes */
    .actions-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin-top:14px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}

    button{
      border:0;border-radius:var(--radius-sm);
      padding:6px 10px;font-size:13px;font-weight:900;cursor:pointer;min-height:34px;
      transition:var(--transition);font-family:var(--font);
      display:flex;align-items:center;justify-content:center;gap:8px;position:relative;overflow:hidden
    }
    button:disabled{opacity:.55;cursor:not-allowed}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;box-shadow:0 4px 12px rgba(99,102,241,.25)}
    .btn-primary:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 20px rgba(99,102,241,.32)}
    .btn-dark{background:linear-gradient(135deg,#1e293b,#0f172a);color:#fff;box-shadow:0 4px 12px rgba(15,23,42,.25)}
    .btn-dark:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 20px rgba(15,23,42,.32)}
    .btn-danger{background:linear-gradient(135deg,var(--danger),#dc2626);color:#fff;box-shadow:0 4px 12px rgba(239,68,68,.25)}
    .btn-danger:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 20px rgba(239,68,68,.32)}
    .btn-ghost{background:#fff;border:2px solid var(--line);color:var(--txt)}
    .btn-ghost:hover:not(:disabled){border-color:var(--primary);color:var(--primary);transform:translateY(-1px)}

    .btn-loading{pointer-events:none;opacity:.75}
    .btn-loading::after{
      content:"";position:absolute;width:16px;height:16px;border:2px solid rgba(255,255,255,.35);
      border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Status: sozinho (linha inteira) */
    .status{
      margin-top:12px;padding:12px 14px;border-radius:var(--radius-sm);
      font-size:13px;line-height:1.45;display:flex;align-items:flex-start;gap:10px
    }
    .status i{font-size:16px;margin-top:1px}
    .status.muted{background:#f1f5f9;border:2px solid #e2e8f0;color:var(--muted)}
    .status.ok{background:#dcfce7;border:2px solid #86efac;color:#15803d}
    .status.ok i{color:var(--success)}
    .status.err{background:#fee2e2;border:2px solid #fca5a5;color:#991b1b}
    .status.err i{color:var(--danger)}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.66);display:none;align-items:center;justify-content:center;z-index:1000;backdrop-filter:none;-webkit-backdrop-filter:none;}
    .modal-overlay.active{display:flex}
    .modal{background:#fff;border-radius:var(--radius);padding:20px;max-width:520px;width:92%;box-shadow:0 25px 50px rgba(0,0,0,.3)}
    .modal-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .modal-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;background:linear-gradient(135deg,var(--warning),#f59e0b);color:#fff;flex:0 0 auto}
    .modal-title{font-size:18px;font-weight:900;color:var(--txt)}
    .modal-body{color:var(--muted);line-height:1.55;margin-bottom:16px;white-space:pre-line;font-size:14px}
    .modal-actions{display:flex;gap:10px;justify-content:flex-end}

/* ========================= ZONA DE ATALHOS (1 LINHA - robusta no mobile) ========================= */ 
    .quickbar{ padding:6px; margin:2px 0 2px; overflow:visible; /* n√£o corta chips */ } /* 1 linha com scroll (n√£o esmaga itens) */ 
    .quickbar-grid{ display:flex; gap:8px; align-items:stretch; overflow-x:auto; overflow-y:hidden; -webkit-overflow-scrolling:touch; padding-bottom:2px; } 
    .quickbar-grid::-webkit-scrollbar{display:none} /* tile com largura travada -> nunca ‚Äúexprimido‚Äù */ 
    .qmod{ position:relative; 
          height:40px; 
          width:57px; 
          min-width:57px; 
          flex:0 0 57px; 
          flex-shrink:0; 
          border:2px solid var(--line); 
          border-radius:14px; 
          background:#fff; 
          padding:0; 
          margin:0; 
          overflow:hidden; 
          cursor:pointer; 
          transition:var(--transition); 
          min-height:0; display:block; } 
    
    .qmod:hover{ transform:translateY(-1px); } 
    .qmod.active{ border-color:var(--primary); 
                 box-shadow:0 8px 18px rgba(0,0,0,.10); } 
    
    .qmod.qmod-icon > img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
      padding:0;
      transform:scale(1.22);
      transform-origin:center;
      display:block;
      pointer-events:none;
  }
    /* ===== CHIPS (ATALHOS) ‚Äî tile com imagem + badge ===== */
.quickchips{display:none; margin-top:4px;}
.quickchips.active{display:block}

.quickchips .chips-row{
  display:flex;
  gap:6px;
  align-items:stretch;
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  padding-bottom:0px;
}
.quickchips .chips-row::-webkit-scrollbar{display:none}

.quickchips .chip-tile{
  all: unset;
  box-sizing:border-box;
  position:relative;
  height:31px;
  width:45px;
  min-width:45px;
  flex:0 0 45px;
  border:2px solid var(--line);
  border-radius:11px;
  background:#fff;
  overflow:hidden;
  cursor:pointer;
  transition:var(--transition);
  display:block;
}

.quickchips .chip-tile:hover{ transform:translateY(-1px); border-color:rgba(99,102,241,.45); }
.quickchips .chip-tile.active{ border-color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,.08); }

.quickchips .chip-tile > img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  padding:2px;
  transform:scale(1.15);
  transform-origin:center;
  display:block;
  pointer-events:none;
  z-index:1;
}

.quickchips .chip-badge{
  position:absolute;
  left:3px;
  bottom:3px;
  padding:2px 5px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background:rgba(255,255,255,.92);
  font-size:9px;
  font-weight:900;
  line-height:1;
  color:var(--txt);
  pointer-events:none;
  z-index:2;
}
 
     @media (max-width:420px){ 
      .qmod{height:40px;width:57px;min-width:57px;flex-basis:57px} 
      .qmod > img{transform:scale(1.22);padding:0px} } 
    
    @media (min-width:760px){ 
      .qmod{height:49px;width:69px;min-width:69px;flex-basis:69px} 
      .qmod > img{transform:scale(1.22);padding:0px} }

  
  </style>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <div class="logo-container" title="Loja selecionada">
        <img src="./icons/loterpraca.png" alt="Logo" id="logoImg" />
      </div>

      <div class="header-title">
        <h1 id="headerTitle">Sistema de Bol√µes</h1>
        <p id="headerSub">Cadastro e movimenta√ß√£o</p>
      </div>

      <div class="brand-logos" aria-label="Atalhos das lojas">
        <button type="button" class="brand-btn" data-loja="Boulevard" title="Boulevard">
          <img src="./icons/boulevard.png" alt="Boulevard">
        </button>
        <button type="button" class="brand-btn" data-loja="Centro" title="Centro">
          <img src="./icons/loterpraca.png" alt="Centro">
        </button>
        <button type="button" class="brand-btn" data-loja="Lotobel" title="Lotobel">
          <img src="./icons/lotobel.png" alt="Lotobel">
        </button>
        <button type="button" class="brand-btn" data-loja="Santa Tereza" title="Santa Tereza">
          <img src="./icons/santa-tereza.png" alt="Santa Tereza">
        </button>
      </div>
    </div>
  </header>

  <div class="wrap">

    <!-- ZONA DE ATALHOS (acima do cadastro) -->
    <div class="quickbar" id="quickZone">
      <div class="quickbar-grid" id="modGrid"></div>
      <div class="quickchips" id="chipsWrap">
        <div class="chips-row" id="chipsRow"></div>
      </div>
    </div>

    <!-- DADOS -->
    <div class="card">
      <div class="section-header">
        <div class="section-icon"><i class="fas fa-ticket-alt"></i></div>
        <h2 class="section-title">Dados do bol√£o</h2>
      </div>

      <!-- Loja de Origem sozinho -->
      <div class="grid-1">
        <div class="field">
          <label><i class="fas fa-store"></i> Loja de origem</label>
          <select id="lojaOrigem" required>
            <option value="">Selecione a loja‚Ä¶</option>
            <option>Boulevard</option>
            <option>Centro</option>
            <option>Lotobel</option>
            <option>Santa Tereza</option>
          </select>
        </div>
      </div>

      <!-- Modalidade + Concurso -->
      <div class="grid-2">
        <div class="field">
          <label><i class="fas fa-clover"></i> Modalidade</label>
          <select id="modalidade" required>
            <option value="">Selecione‚Ä¶</option>
            <option>Mega Sena</option>
            <option>Lotofacil</option>
            <option>Quina</option>
            <option>Dupla Sena</option>
            <option>Dia de Sorte</option>
            <option>Super7</option>
            <option>Milionaria</option>
            <option>Timemania</option>
            <option>Lotomania</option>
            <option>Federal</option>
            <option>Loteca</option>
            <option>Pascoa</option>
            <option>Sao Joao</option>
            <option>Independencia</option>
            <option>Virada</option>
          </select>
        </div>

        <div class="field">
          <label><i class="fas fa-hashtag"></i> Concurso</label>
          <input id="concurso" inputmode="numeric" placeholder="Ex: 2654" required />
        </div>
      </div>

      <!-- Data inicial + Data concurso -->
      <div class="grid-2">
        <div class="field">
          <label><i class="fas fa-calendar-day"></i> Data inicial</label>
          <input id="dataInicial" type="date" required />
        </div>
        <div class="field">
          <label><i class="fas fa-calendar-check"></i> Data do concurso</label>
          <input id="dataConcurso" type="date" required />
        </div>
      </div>

      <!-- Qtd de Jogos + Qtd de Dezenas -->
      <div class="grid-2">
        <div class="field">
          <label><i class="fas fa-list-ol"></i> Qtd de Jogos</label>
          <input id="qtdJogos" inputmode="numeric" placeholder="Ex: 10" required />
        </div>
        <div class="field">
          <label><i class="fas fa-dice"></i> Qtd de Dezenas</label>
          <input id="qtdDezenas" inputmode="numeric" placeholder="Ex: 6" required />
        </div>
      </div>

      <!-- Valor da cota + Qtd de Cotas -->
      <div class="grid-2">
        <div class="field">
          <label><i class="fas fa-money-bill-wave"></i> Valor da cota (R$)</label>
          <input id="valorCota" inputmode="decimal" placeholder="Ex: 15,00" required />
        </div>
        <div class="field">
          <label><i class="fas fa-users"></i> Qtd de Cotas</label>
          <input id="cotas" inputmode="numeric" placeholder="Ex: 50" required />
        </div>
      </div>

      <!-- Cadastrar / Limpar / Deletar -->
      <div class="actions-3">
        <button type="button" class="btn-primary" id="btnCadastrar">
          <i class="fas fa-check"></i><span>Cadastrar</span>
        </button>
        <button type="button" class="btn-ghost" id="btnLimpar">
          <i class="fas fa-eraser"></i><span>Limpar</span>
        </button>
        <button type="button" class="btn-danger" id="btnDeletar" title="Deleta o bol√£o (envia -999)">
          <i class="fas fa-trash"></i><span>Deletar</span>
        </button>
      </div>

      <!-- Status sozinho -->
      <div id="status" class="status muted">
        <i class="fas fa-info-circle"></i>
        <span>Status.</span>
      </div>
    </div>

    <!-- MOVIMENTAR -->
<div class="card">
  <div class="section-header">
    <div class="section-icon"><i class="fas fa-exchange-alt"></i></div>

    <h2 class="section-title inline-title" style="display: flex; align-items: center; gap: 12px;">
      <span>Movimentar</span>

      <div style="display: flex; align-items: center; gap: 8px; margin-left: 16px;">
        <span class="mov-origem" id="movOrigemChip">
          <i class="fas fa-store"></i>
          <span id="movOrigemText">Origem: ‚Äî</span>
        </span>

        <button
          type="button"
          id="btnBuscarControle"
          onclick="buscarControle()"
          class="btn-ghost"
          title="Buscar dados no Controle"
          style="padding: 4px 10px; font-size: 14px; cursor: pointer;"
        >
          üîç Buscar
        </button>
      </div>
    </h2>
  </div>


      <div class="grid-2 force-2">
        <div class="field">
          <label><i class="fas fa-building"></i> Boulevard</label>
          <input id="deltaBoulevard" inputmode="numeric" placeholder="0" />
        </div>
        <div class="field">
          <label><i class="fas fa-city"></i> Centro</label>
          <input id="deltaCentro" inputmode="numeric" placeholder="0" />
        </div>
      </div>

      <div class="grid-2 force-2">
        <div class="field">
          <label><i class="fas fa-landmark"></i> Lotobel</label>
          <input id="deltaLotobel" inputmode="numeric" placeholder="0" />
        </div>
        <div class="field">
          <label><i class="fas fa-church"></i> Santa Tereza</label>
          <input id="deltaSantaTereza" inputmode="numeric" placeholder="0" />
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn-dark" id="btnMovimentar">
          <i class="fas fa-arrows-alt-h"></i><span>Movimentar</span>
        </button>
        <button type="button" class="btn-ghost" id="btnZerarMov">
          <i class="fas fa-undo"></i><span>Limpar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-icon"><i class="fas fa-question-circle"></i></div>
        <h3 class="modal-title" id="modalTitle">Confirma√ß√£o</h3>
      </div>
      <div class="modal-body" id="modalBody">Mensagem do modal</div>
      <div class="modal-actions">
        <button type="button" class="btn-ghost" id="modalCancel">
          <i class="fas fa-times"></i><span>Cancelar</span>
        </button>
        <button type="button" class="btn-primary" id="modalConfirm">
          <i class="fas fa-check"></i><span>Confirmar</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    /********************************************************
     * CONFIG
     ********************************************************/
    const API_URL = "https://script.google.com/macros/s/AKfycbwQGTk3ThySgM1Kz8V7BKTmh4G2Mo08HDn5gbp4cLUXNmuHol6dgOrPgxRLuTzogLLI/exec";

    const LOJA_CONFIG = {
      "Boulevard":    { logo: "./icons/boulevard.png",    theme: "boulevard",    nome: "Boulevard",     position: "50% 50%" },
      "Centro":       { logo: "./icons/loterpraca.png",   theme: "centro",       nome: "Centro",        position: "50% 42%" },
      "Lotobel":      { logo: "./icons/lotobel.png",      theme: "lotobel",      nome: "Lotobel",       position: "50% 50%" },
      "Santa Tereza": { logo: "./icons/santa-tereza.png", theme: "santa-tereza", nome: "Santa Tereza",  position: "50% 50%" }
    };

    // √çcones (arquivos que voc√™ vai subir em ./icons/)
    const MODS = [
      { key:"Mega Sena",    short:"MS", icon:"./icons/mega-sena.png" },
      { key:"Lotofacil",    short:"LF", icon:"./icons/lotofacil.png" },
      { key:"Quina",        short:"QN", icon:"./icons/quina.png" },
      { key:"Dia de Sorte", short:"DI", icon:"./icons/dia-de-sorte.png" },
      { key:"Timemania",    short:"TM", icon:"./icons/timemania.png" },
      { key:"Dupla Sena",   short:"DS", icon:"./icons/dupla.png" },
      { key:"Super7",   short:"S7", icon:"./icons/super-sete.png" },
      { key:"Milionaria",   short:"MN", icon:"./icons/milionaria.png" },
      { key:"Loteca",       short:"LT", icon:"./icons/loteca.png" },
      { key:"Federal", short:"FD", icon:"./icons/federal.png" },
    ];

    // Atalhos por loja + modalidade
    // label = texto do chip; games = qtdJogos; dezenas = qtdDezenas; valor = valorCota; cotas = qtdCotas
    const SHORTCUTS = {
  "Boulevard": {
    "Mega Sena": [
      { label:"[03x10]", games:3, dezenas:10, valor:"51,03", cotas:100 },
      { label:"[02x10]", games:2, dezenas:10, valor:"34,01", cotas:100 },
      { label:"[10x08]", games:10, dezenas:8, valor:"22,68", cotas:100 },
      { label:"[10x07]", games:10, dezenas:7, valor:"18,90", cotas:30 },
    ],
    "Lotofacil": [
      { label:"[02x17]", games:2, dezenas:17, valor:"32,13", cotas:40 },
      { label:"[10x16]", games:10, dezenas:16, valor:"25,19", cotas:30 },
      { label:"[05x16]", games:5, dezenas:16, valor:"12,59", cotas:30 },
      { label:"[10x15]", games:10, dezenas:15, valor:"11,81", cotas:4 },
    ],
    "Quina": [
      { label:"[01x12]", games:1, dezenas:12, valor:"64,15", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[07x07]", games:7, dezenas:7,  valor:"12,15", cotas:49 },
      { label:"[10x06]", games:10, dezenas:6,  valor:"12,14", cotas:20 },
    ],
    "Dia de Sorte": [
      { label:"[01x12]", games:1, dezenas:12, valor:"44,55", cotas:60 },
      { label:"[01x11]", games:1, dezenas:11, valor:"27,82", cotas:40 },
      { label:"[01x10]", games:1, dezenas:10, valor:"27,00", cotas:15 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"17,99", cotas:15 },
    ],
    "Timemania": [
      { label:"[15x10]", games:15, dezenas:10, valor:"10,12", cotas:7 },
    ],
    "Dupla Sena": [
      { label:"[10x09]", games:10, dezenas:9,  valor:"68,04", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"22,68", cotas:50 },
      { label:"[10x17]", games:10, dezenas:17, valor:"18,90", cotas:15 },
    ],
    "Super7": [
      { label:"[07x10]", games:7, dezenas:10, valor:"56,70", cotas:5 },
      { label:"[05x10]", games:5, dezenas:10, valor:"54,00", cotas:3 },
      { label:"[04x11]", games:4, dezenas:11, valor:"51,83", cotas:5 },
      { label:"[10x10]", games:10, dezenas:10, valor:"21,60", cotas:10 },
    ],
    "Milionaria": [
      { label:"[01x10]", games:1, dezenas:10, valor:"48,60", cotas:35 },
      { label:"[05x07]", games:5, dezenas:7,  valor:"18,90", cotas:15 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:20 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:9  },
    ],
    "Loteca": [
      { label:"[01x26]", games:1, dezenas:26, valor:"39,36", cotas:50 },
      { label:"[01x24]", games:1, dezenas:24, valor:"21,87", cotas:30 },
    ],
    "Federal": [
      { label:"[10x04]", games:1, dezenas:4,  valor:"4,00",  cotas:10 },
      { label:"[10x10]", games:1, dezenas:10, valor:"10,00", cotas:10 },
      { label:"[E.NML]", games:10, dezenas:4,  valor:"32,10", cotas:1 },
      { label:"[E.ESP]", games:10, dezenas:10, valor:"80,40", cotas:1 },
    ],
  },

  "Centro": {
    "Mega Sena": [
      { label:"[03x10]", games:3, dezenas:10, valor:"51,03", cotas:100 },
      { label:"[02x10]", games:2, dezenas:10, valor:"34,01", cotas:100 },
      { label:"[10x08]", games:10, dezenas:8, valor:"22,68", cotas:100 },
      { label:"[10x07]", games:10, dezenas:7, valor:"18,90", cotas:30 },
    ],
    "Lotofacil": [
      { label:"[07x17]", games:7, dezenas:17, valor:"112,44", cotas:40 },
      { label:"[10x16]", games:10, dezenas:16, valor:"25,19", cotas:30 },
      { label:"[05x16]", games:5, dezenas:16, valor:"12,59", cotas:30 },
      { label:"[10x15]", games:10, dezenas:15, valor:"11,81", cotas:4 },
    ],
    "Quina": [
      { label:"[01x12]", games:1, dezenas:12, valor:"64,15", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[07x07]", games:7, dezenas:7,  valor:"12,15", cotas:49 },
      { label:"[10x06]", games:10, dezenas:6,  valor:"12,14", cotas:20 },
    ],
    "Dia de Sorte": [
      { label:"[01x12]", games:1, dezenas:12, valor:"44,55", cotas:60 },
      { label:"[01x11]", games:1, dezenas:11, valor:"27,82", cotas:40 },
      { label:"[01x10]", games:1, dezenas:10, valor:"27,00", cotas:15 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"17,99", cotas:15 },
    ],
    "Timemania": [
      { label:"[15x10]", games:15, dezenas:10, valor:"14,17", cotas:5 },
    ],
    "Dupla Sena": [
      { label:"[10x09]", games:10, dezenas:9,  valor:"68,04", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"22,68", cotas:50 },
      { label:"[01x10]", games:1, dezenas:10, valor:"42,52", cotas:20 },
    ],
    "Super7": [
      { label:"[07x10]", games:7, dezenas:10, valor:"56,70", cotas:5 },
      { label:"[05x10]", games:5, dezenas:10, valor:"54,00", cotas:3 },
      { label:"[04x11]", games:4, dezenas:11, valor:"51,83", cotas:5 },
      { label:"[10x10]", games:10, dezenas:10, valor:"21,60", cotas:10 },
    ],
    "Milionaria": [
      { label:"[01x09]", games:1, dezenas:9,  valor:"51,03", cotas:40 },
      { label:"[05x07]", games:5, dezenas:7,  valor:"18,90", cotas:15 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:20 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:9  },
    ],
    "Loteca": [
      { label:"[01x26]", games:1, dezenas:26, valor:"39,36", cotas:50 },
      { label:"[01x24]", games:1, dezenas:24, valor:"21,87", cotas:30 },
    ],
    "Federal": [
      { label:"[10x04]", games:1, dezenas:4,  valor:"4,00",  cotas:10 },
      { label:"[10x10]", games:1, dezenas:10, valor:"10,00", cotas:10 },
      { label:"[E.NML]", games:10, dezenas:4,  valor:"32,10", cotas:1 },
      { label:"[E.ESP]", games:10, dezenas:10, valor:"80,40", cotas:1 },
    ],
  },

  "Lotobel": {
    "Mega Sena": [
      { label:"[03x10]", games:3, dezenas:10, valor:"51,03", cotas:100 },
      { label:"[02x10]", games:2, dezenas:10, valor:"34,01", cotas:100 },
      { label:"[10x08]", games:10, dezenas:8, valor:"22,68", cotas:100 },
      { label:"[10x07]", games:10, dezenas:7, valor:"18,90", cotas:30 },
    ],
    "Lotofacil": [
      { label:"[01x18]", games:1, dezenas:18, valor:"77,11", cotas:50 },
      { label:"[10x16]", games:10, dezenas:16, valor:"25,19", cotas:30 },
      { label:"[05x16]", games:5, dezenas:16, valor:"12,59", cotas:30 },
      { label:"[09x15]", games:9, dezenas:15,  valor:"10,63", cotas:4 },
    ],
    "Quina": [
      { label:"[01x12]", games:1, dezenas:12, valor:"64,15", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[07x07]", games:7, dezenas:7,  valor:"12,15", cotas:49 },
      { label:"[10x06]", games:10, dezenas:6,  valor:"12,14", cotas:20 },
    ],
    "Dia de Sorte": [
      { label:"[01x12]", games:1, dezenas:12, valor:"44,55", cotas:60 },
      { label:"[01x11]", games:1, dezenas:11, valor:"27,82", cotas:40 },
      { label:"[01x10]", games:1, dezenas:10, valor:"27,00", cotas:15 },
      { label:"[02x09]", games:2, dezenas:9,  valor:"20,44", cotas:12 },
    ],
    "Timemania": [
      { label:"[15x10]", games:15, dezenas:10, valor:"14,17", cotas:5 },
    ],
    "Dupla Sena": [
      { label:"[10x09]", games:10, dezenas:9,  valor:"68,04", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"22,68", cotas:50 },
      { label:"[10x17]", games:10, dezenas:17, valor:"18,90", cotas:15 },
    ],
    "Super7": [
      { label:"[07x10]", games:7, dezenas:10, valor:"56,70", cotas:5 },
      { label:"[05x10]", games:5, dezenas:10, valor:"54,00", cotas:3 },
      { label:"[04x11]", games:4, dezenas:11, valor:"51,83", cotas:5 },
      { label:"[10x10]", games:10, dezenas:10, valor:"21,60", cotas:10 },
    ],
    "Milionaria": [
      { label:"[08x06]", games:8, dezenas:6,  valor:"48,59", cotas:20 },
      { label:"[05x07]", games:5, dezenas:7,  valor:"18,90", cotas:15 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:20 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:9  },
    ],
    "Loteca": [
      { label:"[01x26]", games:1, dezenas:26, valor:"39,36", cotas:50 },
      { label:"[01x24]", games:1, dezenas:24, valor:"21,87", cotas:30 },
    ],
    "Federal": [
      { label:"[10x04]", games:1, dezenas:4,  valor:"4,00",  cotas:10 },
      { label:"[10x10]", games:1, dezenas:10, valor:"10,00", cotas:10 },
      { label:"[E.NML]", games:10, dezenas:4,  valor:"32,10", cotas:1 },
      { label:"[E.ESP]", games:10, dezenas:10, valor:"80,40", cotas:1 },
    ],
  },

  "Santa Tereza": {
    "Mega Sena": [
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:100 },
      { label:"[02x10]", games:2, dezenas:10, valor:"34,01", cotas:100 },
      { label:"[10x08]", games:10, dezenas:8, valor:"22,68", cotas:100 },
      { label:"[10x07]", games:10, dezenas:7, valor:"18,90", cotas:30 },
    ],
    "Lotofacil": [
      { label:"[02x17]", games:2, dezenas:17, valor:"32,13", cotas:40 },
      { label:"[10x16]", games:10, dezenas:16, valor:"25,19", cotas:30 },
      { label:"[05x16]", games:5, dezenas:16, valor:"12,59", cotas:30 },
      { label:"[10x15]", games:10, dezenas:15, valor:"11,81", cotas:4 },
    ],
    "Quina": [
      { label:"[01x12]", games:1, dezenas:12, valor:"64,15", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[07x07]", games:7, dezenas:7,  valor:"12,15", cotas:49 },
      { label:"[10x06]", games:10, dezenas:6,  valor:"12,14", cotas:20 },
    ],
    "Dia de Sorte": [
      { label:"[01x11]", games:1, dezenas:11, valor:"27,82", cotas:40 },
      { label:"[01x10]", games:1, dezenas:10, valor:"27,00", cotas:15 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"17,99", cotas:15 },
      { label:"[05x08]", games:5, dezenas:8,  valor:"13,50", cotas:10 },
    ],
    "Timemania": [
      { label:"[15x10]", games:15, dezenas:10, valor:"10,12", cotas:7 },
    ],
    "Dupla Sena": [
      { label:"[10x09]", games:10, dezenas:9,  valor:"68,04", cotas:50 },
      { label:"[01x11]", games:1, dezenas:11, valor:"37,42", cotas:50 },
      { label:"[10x08]", games:10, dezenas:8,  valor:"22,68", cotas:50 },
      { label:"[10x17]", games:10, dezenas:17, valor:"18,90", cotas:15 },
    ],
    "Super7": [
      { label:"[07x10]", games:7, dezenas:10, valor:"56,70", cotas:5 },
      { label:"[05x10]", games:5, dezenas:10, valor:"54,00", cotas:3 },
      { label:"[04x11]", games:4, dezenas:11, valor:"51,83", cotas:5 },
      { label:"[10x10]", games:10, dezenas:10, valor:"21,60", cotas:10 },
    ],
    "Milionaria": [
      { label:"[10x06]", games:10, dezenas:6, valor:"12,14", cotas:40 },
      { label:"[05x07]", games:5, dezenas:7,  valor:"18,90", cotas:15 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:20 },
      { label:"[14x06]", games:14, dezenas:6,  valor:"12,59", cotas:9  },
    ],
    "Loteca": [
      { label:"[01x26]", games:1, dezenas:26, valor:"39,36", cotas:50 },
      { label:"[01x24]", games:1, dezenas:24, valor:"21,87", cotas:30 },
    ],
    "Federal": [
      { label:"[10x04]", games:1, dezenas:4,  valor:"4,00",  cotas:10 },
      { label:"[10x10]", games:1, dezenas:10, valor:"10,00", cotas:10 },
      { label:"[E.NML]", games:10, dezenas:4,  valor:"32,10", cotas:1 },
      { label:"[E.ESP]", games:10, dezenas:10, valor:"80,40", cotas:1 },
    ],
  }
};

  
    const $ = (id) => document.getElementById(id);

    function setStatus(msg, type = "muted", icon = "info-circle") {
      const el = $("status");
      el.className = `status ${type}`;
      el.innerHTML = `<i class="fas fa-${icon}"></i><span>${msg}</span>`;
    }

    function setButtonLoading(btn, loading) {
      if (loading) { btn.classList.add("btn-loading"); btn.disabled = true; }
      else { btn.classList.remove("btn-loading"); btn.disabled = false; }
    }

    function onlyDigits(v) { return String(v || "").replace(/[^\d\-]/g, ""); }

    function parseBRMoneyToNumber(v) {
      if (v == null) return 0;
      const s = String(v).trim();
      if (!s) return 0;
      const cleaned = s.replace(/[R$\s]/g, "").replace(/\./g, "").replace(",", ".");
      const n = Number(cleaned);
      return Number.isFinite(n) ? n : 0;
    }
function getModIcon(modKey){
  const m = MODS.find(x => x.key === modKey);
  return m ? m.icon : "";
}
function buildCadConfirmText(base){
  return [
    `ORIGEM: ${base.lojaOrigem}`,
    `BOLAO: ${base.modalidade} | CONC: ${base.concurso}`,
    `PER√çODO: ${formatDateBR(base.dataInicial)} ‚Üí ${formatDateBR(base.dataConcurso)}`,
    `JOGOS: ${base.qtdJogos} | DEZENAS: ${base.qtdDezenas}`,
    `COTAS: ${base.cotas} | COTA: ${fmtBRL(base.valorCota)}`,
    `CONFIRMA?`
  ].join("\n");
}


    function buildMovConfirmText(base, deltas){
  const linhas = [];

  linhas.push(`ORIGEM: ${base.lojaOrigem}`);
  linhas.push(`BOLAO: ${base.modalidade} | CONC: ${base.concurso}`);
  linhas.push(`COTA: ${fmtBRL(base.valorCota)}`);
  linhas.push(`DESTINOS:`);

  const destinos = [
    ["Boulevard",    deltas.deltaBoulevard],
    ["Centro",       deltas.deltaCentro],
    ["Lotobel",      deltas.deltaLotobel],
    ["Santa Tereza", deltas.deltaSantaTereza],
  ]
    .filter(([nome]) => nome !== base.lojaOrigem)
    .filter(([, v]) => v !== 0); // ‚úÖ oculta 0

  if (!destinos.length) {
    linhas.push(`(nenhum destino)`);
  } else {
    destinos.forEach(([nome, v]) => {
      linhas.push(`${nome}: ${v > 0 ? "+" : ""}${v}`);
    });
  }

  linhas.push(`CONFIRMA?`);
  return linhas.join("\n");
}

  
  async function callApi(action, payloadObj) {
    const cbName = "cb_" + Math.random().toString(36).slice(2);
    const payload = base64Json(payloadObj || {});
    const url = `${API_URL}?action=${encodeURIComponent(action)}&callback=${cbName}&payload=${encodeURIComponent(payload)}&_t=${Date.now()}`;
    return await jsonp(url, cbName);
  }

  function base64Json(obj) {
    const json = JSON.stringify(obj);
    return btoa(unescape(encodeURIComponent(json)));
  }

  function jsonp(url, cbName) {
    return new Promise((resolve, reject) => {
      const s = document.createElement("script");
      let done = false;

      const timer = setTimeout(() => {
        if (done) return;
        done = true;
        cleanup();
        reject(new Error("Timeout na chamada da API."));
      }, 25000);

      function cleanup() {
        clearTimeout(timer);
        try { delete window[cbName]; } catch (e) {}
        if (s && s.parentNode) s.parentNode.removeChild(s);
      }

      window[cbName] = (data) => {
        if (done) return;
        done = true;
        cleanup();
        resolve(data);
      };

      s.onerror = () => {
        if (done) return;
        done = true;
        cleanup();
        reject(new Error("Falha carregando JSONP (script)."));
      };

      s.src = url;
      document.body.appendChild(s);
    });
  }

   
    function getMovDeltas() {
      const deltaBoulevard = Number(onlyDigits($("deltaBoulevard").value || "0")) || 0;
      const deltaCentro = Number(onlyDigits($("deltaCentro").value || "0")) || 0;
      const deltaLotobel = Number(onlyDigits($("deltaLotobel").value || "0")) || 0;
      const deltaSantaTereza = Number(onlyDigits($("deltaSantaTereza").value || "0")) || 0;
      return { deltaBoulevard, deltaCentro, deltaLotobel, deltaSantaTereza };
    }

    function saveDraft() {
      const draft = {
        lojaOrigem: $("lojaOrigem").value,
        modalidade: $("modalidade").value,
        concurso: $("concurso").value,
        dataInicial: $("dataInicial").value,
        dataConcurso: $("dataConcurso").value,
        qtdJogos: $("qtdJogos").value,
        qtdDezenas: $("qtdDezenas").value,
        cotas: $("cotas").value,
        valorCota: $("valorCota").value,
        deltaBoulevard: $("deltaBoulevard").value,
        deltaCentro: $("deltaCentro").value,
        deltaLotobel: $("deltaLotobel").value,
        deltaSantaTereza: $("deltaSantaTereza").value,
        activeQuickMod: localStorage.getItem("active_quick_mod") || ""
      };
      localStorage.setItem("bolo_draft", JSON.stringify(draft));
    }

    function loadDraft() {
      try {
        const raw = localStorage.getItem("bolo_draft");
        if (!raw) return;
        const d = JSON.parse(raw);
        $("lojaOrigem").value = d.lojaOrigem || "";
        $("modalidade").value = d.modalidade || "";
        $("concurso").value = d.concurso || "";
        $("dataInicial").value = d.dataInicial || "";
        $("dataConcurso").value = d.dataConcurso || "";
        $("qtdJogos").value = d.qtdJogos || "";
        $("qtdDezenas").value = d.qtdDezenas || "";
        $("cotas").value = d.cotas || "";
        $("valorCota").value = d.valorCota || "";
        $("deltaBoulevard").value = d.deltaBoulevard || "";
        $("deltaCentro").value = d.deltaCentro || "";
        $("deltaLotobel").value = d.deltaLotobel || "";
        $("deltaSantaTereza").value = d.deltaSantaTereza || "";
        if (d.activeQuickMod) localStorage.setItem("active_quick_mod", d.activeQuickMod);
      } catch (e) {}
    }
    
    function clearFieldsExceptLoja() {
  const idsToClear = [
    "modalidade", "concurso", "dataInicial", "dataConcurso",
    "qtdJogos", "qtdDezenas", "valorCota", "cotas",
    "deltaBoulevard", "deltaCentro", "deltaLotobel", "deltaSantaTereza"
  ];

  idsToClear.forEach(id => {
    const el = $(id);
    if (el) el.value = "";
  });

  // ‚ö†Ô∏è Salva rascunho atualizado
  saveDraft();
}

    function clearMov() {
      $("deltaBoulevard").value = "";
      $("deltaCentro").value = "";
      $("deltaLotobel").value = "";
      $("deltaSantaTereza").value = "";
      saveDraft();
    }
function formatDateBR(dateStr) {
  if (!dateStr) return "-";

  // Se vier "YYYY-MM-DD" do input date, n√£o usa Date() (evita UTC shift)
  if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
    const [y, m, d] = dateStr.split("-");
    return `${d}/${m}/${y}`;
  }

  // Se vier ISO completo (carimbo do backend)
  const d = new Date(dateStr);
  if (isNaN(d)) return "-";

  const dia = String(d.getDate()).padStart(2, "0");
  const mes = String(d.getMonth() + 1).padStart(2, "0");
  const ano = d.getFullYear();
  return `${dia}/${mes}/${ano}`;
}

    function fmtBRL(n) {
      const num = Number(n || 0);
      return num.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    function buildExistsConfirmText(base) {
      return [
        `Bol√£o da ${base.modalidade} Concurso ${base.concurso}`,
        `${base.qtdJogos} jogos de ${base.qtdDezenas} dezenas`,
        `Valor ${fmtBRL(base.valorCota)}`,
        ``,
        `J√° existe.`,
        `Adicionar ${base.cotas} cotas nesse bol√£o?`
      ].join("\n");
    }

  function showModal(title, body, onConfirm, onCancel) {
  const overlay = $("modalOverlay");
  const modalBox = overlay.querySelector(".modal");
  const btnCancel = $("modalCancel");
  const btnConfirm = $("modalConfirm");

  $("modalTitle").innerText = title;
  $("modalBody").innerText = body; // texto puro

  // limpa handlers antigos
  btnCancel.onclick = null;
  btnConfirm.onclick = null;
  overlay.onclick = null;
  if (modalBox) modalBox.onclick = null;

  const fechar = () => overlay.classList.remove("active");

  const cancelar = () => {
    fechar();
    if (typeof onCancel === "function") onCancel();
  };

  // clicar fora cancela (ANTES era s√≥ fechar)
  overlay.onclick = cancelar;
  if (modalBox) modalBox.onclick = (e) => e.stopPropagation();

  if (!onConfirm) {
    btnCancel.style.display = "none";
    btnConfirm.innerText = "OK";
    btnConfirm.onclick = () => fechar();
  } else {
    btnCancel.style.display = "flex";
    btnConfirm.innerText = "Confirmar";

    btnCancel.onclick = (e) => {
      e.preventDefault();
      e.stopPropagation();
      cancelar();
    };

    btnConfirm.onclick = async (e) => {
      e.preventDefault();
      e.stopPropagation();
      fechar();
      await onConfirm();
    };
  }

  overlay.classList.add("active");
}


function stripEq(s){ return String(s||"").replace(/^=/,"").trim(); }
    
function baseExprOrNumber(exprReal, atualNum){
  const expr = stripEq(exprReal);
  return expr ? expr : String(Number(atualNum || 0));
}

function montarLinhaCalculo(label, atual, formulaReal, delta) {
  const mov = Number(delta || 0);
  const atualNum = Number(atual || 0);

  const base = baseExprOrNumber(formulaReal, atualNum);

  if (mov === 0) return `${label}: ${base} (sem altera√ß√£o)`;

  const sinal = mov > 0 ? "+" : "";           // para mostrar [+3]
  const final = atualNum + mov;

  // exemplo: "5-2+4 [+3] -> 10"
  return `${label}: ${base} [${sinal}${mov}] ‚ûî ${final}`;
}
function fmtDeltaColored(mov){
  const n = Number(mov || 0);
  if (n === 0) return `<span style="color:#0f172a; font-weight:900;">0</span>`;
  const cor = n > 0 ? "#16a34a" : "#dc2626";
  const sinal = n > 0 ? "+" : "";
  return `<span style="color:${cor}; font-weight:900;">${sinal}${n}</span>`;
}

function linhaMovHtml(nome, atualNum, exprReal, delta){
  const mov = Number(delta || 0);
  const atual = Number(atualNum || 0);
  const final = atual + mov;

  const baseHtml = exprHtml(exprReal, atualNum);
  const deltaHtml = fmtDeltaColored(mov);

  const exprComDelta =
    mov === 0 ? baseHtml :
    (mov > 0
      ? `${baseHtml} <span style="color:#0f172a; font-weight:900;">+</span> ${deltaHtml}`
      : `${baseHtml} ${deltaHtml}`);

  return `
    <div style="display:flex; justify-content:space-between; gap:12px; padding:10px 0; border-bottom:1px solid rgba(0,0,0,.06);">
      <div style="font-weight:900; color:#334155;">${nome}</div>
      <div style="text-align:right;">
        <div style="font-size:14px; line-height:1.2;">${exprComDelta}</div>
        <div style="font-size:12px; color:#64748b; margin-top:2px;">‚ûî <span style="font-weight:900; color:#0f172a;">${final}</span></div>
      </div>
    </div>
  `;
}


    function closeModal() { $("modalOverlay").classList.remove("active"); }

    function updateBrandActive(loja) {
      document.querySelectorAll(".brand-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-loja") === loja);
      });
    }

    function updateThemeAndLogo() {
      const loja = $("lojaOrigem").value;
      const config = LOJA_CONFIG[loja];
      const img = $("logoImg");

      if (config) {
        document.body.setAttribute("data-theme", config.theme);
        img.src = config.logo;
        img.alt = `Logo ${config.nome}`;
        img.style.objectPosition = config.position || "center";

        $("headerTitle").textContent = `${config.nome}`;
        $("headerSub").textContent = "Cadastro";
        updateBrandActive(loja);
      } else {
        document.body.removeAttribute("data-theme");
        img.src = "./icons/loterpraca.png";
        img.alt = "Loterpra√ßa";
        img.style.objectPosition = "center";

        $("headerTitle").textContent = "Sistema de Bol√µes";
        $("headerSub").textContent = "Cadastro e movimenta√ß√£o";
        updateBrandActive("");
      }
    }

    function updateMovimentarUIByOrigem() {
      const loja = $("lojaOrigem").value.trim();
      const chip = $("movOrigemText");
      if (chip) chip.textContent = loja ? `Origem: ${loja}` : "Origem: ‚Äî";

      const map = [
        { loja: "Boulevard", inputId: "deltaBoulevard" },
        { loja: "Centro", inputId: "deltaCentro" },
        { loja: "Lotobel", inputId: "deltaLotobel" },
        { loja: "Santa Tereza", inputId: "deltaSantaTereza" },
      ];

      map.forEach(({ loja: lojaName, inputId }) => {
        const el = $(inputId);
        if (!el) return;

        const shouldDisable = !!loja && loja === lojaName;
        el.disabled = shouldDisable;
        if (shouldDisable) el.value = "";
      });
    }

    /********************************************************
     * QUICKBAR (ATALHOS)
     ********************************************************/
   function buildModButton(mod){
  const btn = document.createElement("button");
  btn.type = "button";
  btn.className = "qmod qmod-icon";
  btn.setAttribute("data-mod", mod.key);
  btn.setAttribute("aria-label", mod.key);
  btn.title = mod.key;

  const img = document.createElement("img");
  img.src = mod.icon;
  img.alt = mod.key; // acessibilidade
  img.loading = "lazy";

  btn.appendChild(img);
  return btn;
}
    function setActiveModButton(modKey){
      document.querySelectorAll(".qmod").forEach(b => {
        b.classList.toggle("active", b.getAttribute("data-mod") === modKey);
      });
    }

    function getShortcutsFor(loja, modalidade){
      if (!loja || !modalidade) return [];
      return (SHORTCUTS[loja] && SHORTCUTS[loja][modalidade]) ? SHORTCUTS[loja][modalidade] : [];
    }

    function fmtMoneyBR(v) {
  // SEMPRE retorna string "183,60"
  if (v === null || v === undefined || v === "") return "0,00";

  let s = String(v).trim();

  // Se j√° vier no formato BR correto
  if (/^\d+,\d{2}$/.test(s)) return s;

  // Se vier Number ou "183.6"
  const n = Number(
    s
      .replace(/[R$\s]/g, "")
      .replace(/\./g, "")
      .replace(",", ".")
  );

  if (!Number.isFinite(n)) return "0,00";
  return n.toFixed(2).replace(".", ",");
}
       
   async function applyShortcut(modKey, sc){
  const loja = $("lojaOrigem").value.trim();
  if (!loja) {
    setStatus("Selecione a loja de origem antes de usar atalhos.", "err", "exclamation-circle");
    return;
  }

  // Preenche s√≥ o que o atalho define (sem adivinhar nada)
  $("modalidade").value = modKey;
  $("qtdJogos").value = sc.games;
  $("qtdDezenas").value = sc.dezenas;
  $("valorCota").value = fmtMoneyBR(sc.valor);
  $("cotas").value = sc.cotas;

  // N√ÉO mexe em:
  // $("concurso")
  // $("dataInicial")
  // $("dataConcurso")

  setStatus(`Atalho aplicado: ${modKey} ${sc.label}`, "ok", "check-circle");
  saveDraft();
}
    
    function renderChips(modKey){
  const loja = $("lojaOrigem").value.trim();
  const chips = getShortcutsFor(loja, modKey);
  const wrap = $("chipsWrap");
  const row = $("chipsRow");
  row.innerHTML = "";

  if (!loja || !modKey || !chips.length) {
    wrap.classList.remove("active");
    return;
  }

  // pega o √≠cone base da modalidade (mesmo do topo)
  const modObj = MODS.find(m => m.key === modKey);
  const baseIcon = modObj ? modObj.icon : "";

  chips.forEach(sc => {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "chip-tile";
    b.title = `${modKey} ${sc.label}`;

    // imagem base (por enquanto: √≠cone da modalidade)
    if (baseIcon) {
      const img = document.createElement("img");
      img.src = baseIcon;
      img.alt = modKey;
      img.loading = "lazy";
      b.appendChild(img);
    }

    // badge com o texto do atalho
    const badge = document.createElement("span");
    badge.className = "chip-badge";
    badge.textContent = sc.label;
    b.appendChild(badge);

    b.onclick = () => applyShortcut(modKey, sc);
    row.appendChild(b);
  });

  wrap.classList.add("active");
}

    function renderQuickbar(){
      const grid = $("modGrid");
      grid.innerHTML = "";
      MODS.forEach(mod => {
        const btn = buildModButton(mod);
        btn.onclick = () => {
  const loja = $("lojaOrigem").value.trim();
  if (!loja) {
    setStatus("Selecione a loja de origem antes de usar os atalhos.", "err", "exclamation-circle");
    return;
  }

  const prev = localStorage.getItem("active_quick_mod") || "";
const next = mod.key;

if (prev !== next) {
  clearFieldsExceptLoja();
}


    localStorage.setItem("active_quick_mod", next);
    setActiveModButton(next);
    renderChips(next);

    // (opcional) j√° seta o select de modalidade junto com o quickbar
    $("modalidade").value = next;

    saveDraft();
};

        grid.appendChild(btn);
      });

      const active = localStorage.getItem("active_quick_mod") || "";
      if (active) {
        setActiveModButton(active);
        renderChips(active);
      } else {
        $("chipsWrap").classList.remove("active");
      }
    }

    function refreshQuickbarForLoja(){
      // quando muda loja: mant√©m a modalidade ativa (se houver) e s√≥ troca os chips
      const active = localStorage.getItem("active_quick_mod") || "";
      if (active) renderChips(active);
      else $("chipsWrap").classList.remove("active");
    }

    /********************************************************
     * ACTIONS
     ********************************************************/
    async function onCadastrar() {
  const btn = $("btnCadastrar");
  try {
    const base = validateBase(true);

    showModal("Confirmar cadastramento", buildCadConfirmText(base), async () => {

      try {
        setStatus("Enviando dados...", "muted", "spinner fa-spin");
        setButtonLoading(btn, true);

        const payload = {
          lojaOrigem: base.lojaOrigem,
          modalidade: base.modalidade,
          concurso: base.concurso,
          dataInicial: base.dataInicial,
          dataConcurso: base.dataConcurso,
          qtdJogos: base.qtdJogos,
          qtdDezenas: base.qtdDezenas,
          cotas: base.cotas,
          valorCota: $("valorCota").value.trim()
        };

        saveDraft();
        const res = await callApi("cadastrar", payload);

        if (res && res.code === "EXISTS") {
          setButtonLoading(btn, false);

          showModal("Bol√£o j√° existe", buildExistsConfirmText(base), async () => {

            setStatus("Adicionando cotas...", "muted", "spinner fa-spin");
            setButtonLoading(btn, true);

            const res2 = await callApi("cadastrar", { ...payload, confirmAdd: true });

            setButtonLoading(btn, false);
            if (res2 && res2.ok) setStatus(res2.message || "Cotas adicionadas!", "ok", "check-circle");
            else setStatus((res2 && res2.message) ? res2.message : "Erro ao somar cotas.", "err", "exclamation-circle");
          });

          setStatus("Aguardando confirma√ß√£o...", "muted", "clock");
          return;
        }

        setButtonLoading(btn, false);
        if (res && res.ok) setStatus(res.message || "Bol√£o cadastrado!", "ok", "check-circle");
        else setStatus((res && res.message) ? res.message : "Erro desconhecido.", "err", "exclamation-circle");

      } catch (err2) {
        setButtonLoading(btn, false);
        setStatus(err2.message || String(err2), "err", "exclamation-circle");
      }
    });

  } catch (err) {
    setButtonLoading(btn, false);
    setStatus(err.message || String(err), "err", "exclamation-circle");
  }
}


    async function onDeletar() {
      const loja = $("lojaOrigem").value;
      showModal(
        "Confirmar dele√ß√£o",
        `Deletar o bol√£o em ${loja}?\n\nEssa a√ß√£o n√£o pode ser desfeita.`,
        async () => {
          const btn = $("btnDeletar");
          try {
            setStatus("Deletando bol√£o...", "muted", "spinner fa-spin");
            setButtonLoading(btn, true);

            const base = validateBase(false);
            const payload = {
              lojaOrigem: base.lojaOrigem,
              modalidade: base.modalidade,
              concurso: base.concurso,
              dataInicial: base.dataInicial,
              dataConcurso: base.dataConcurso,
              qtdJogos: Number(onlyDigits($("qtdJogos").value)) || 1,
              qtdDezenas: Number(onlyDigits($("qtdDezenas").value)) || 1,
              cotas: -999,
              valorCota: $("valorCota").value.trim()

            };

            saveDraft();
            const res = await callApi("cadastrar", payload);

            setButtonLoading(btn, false);
            if (res && res.ok) setStatus(res.message || "Bol√£o deletado!", "ok", "check-circle");
            else setStatus((res && res.message) ? res.message : "Erro desconhecido.", "err", "exclamation-circle");
          } catch (err) {
            setButtonLoading(btn, false);
            setStatus(err.message || String(err), "err", "exclamation-circle");
          }
        }
      );
    }

     async function onMovimentar() {
    const btn = $("btnMovimentar");
  
    try {
      const base = validateMov();
      const deltas = getMovDeltas();
  
      if (!deltas.deltaBoulevard && !deltas.deltaCentro && !deltas.deltaLotobel && !deltas.deltaSantaTereza) {
        throw new Error("Informe pelo menos um valor de destino.");
      }
  
      setButtonLoading(btn, true);
      setStatus("Verificando saldos para movimenta√ß√£o...", "muted", "spinner fa-spin");
  
      const pBusca = {
        lojaOrigem: base.lojaOrigem,
        modalidade: base.modalidade,
        concurso: String(base.concurso).replace(/[^\d]/g, "").trim(),
        valorCota: base.valorCota,
        dataInicial: base.dataInicial || "",
        dataConcurso: base.dataConcurso || ""
      };
  
      let dataAtual = null;
      try {
        const resBusca = await callApi("buscarControle", pBusca);
        console.log("buscarControle RAW:", resBusca);
        console.log("buscarControle DATA:", resBusca?.data);
        console.log("qtdBoulevard:", resBusca?.data?.qtdBoulevard);
        console.log("formulaBoulevard:", resBusca?.data?.formulaBoulevard);
  
        if (resBusca && resBusca.ok && resBusca.data) dataAtual = resBusca.data;
      } catch (e) {
        dataAtual = null;
      }
  
      const saldosParaCalculo = {
        origem: (dataAtual && dataAtual.origem) ? dataAtual.origem : base.lojaOrigem,
        modalidade: (dataAtual && dataAtual.modalidade) ? dataAtual.modalidade : base.modalidade,
        concurso: (dataAtual && dataAtual.concurso) ? dataAtual.concurso : base.concurso,
  
        dtInicial: (dataAtual && dataAtual.dtInicial) ? dataAtual.dtInicial : base.dataInicial,
        dtConcurso: (dataAtual && dataAtual.dtConcurso) ? dataAtual.dtConcurso : base.dataConcurso,
  
        valorCota: (dataAtual && typeof dataAtual.valorCota === "number") ? dataAtual.valorCota : base.valorCota,
  
        qtdBoulevard: (dataAtual && Number.isFinite(dataAtual.qtdBoulevard)) ? dataAtual.qtdBoulevard : 0,
        qtdCentro: (dataAtual && Number.isFinite(dataAtual.qtdCentro)) ? dataAtual.qtdCentro : 0,
        qtdLotobel: (dataAtual && Number.isFinite(dataAtual.qtdLotobel)) ? dataAtual.qtdLotobel : 0,
        qtdSantaTereza: (dataAtual && Number.isFinite(dataAtual.qtdSantaTereza)) ? dataAtual.qtdSantaTereza : 0,
  
        formulaBoulevard: (dataAtual && dataAtual.formulaBoulevard) ? dataAtual.formulaBoulevard : "",
        formulaCentro: (dataAtual && dataAtual.formulaCentro) ? dataAtual.formulaCentro : "",
        formulaLotobel: (dataAtual && dataAtual.formulaLotobel) ? dataAtual.formulaLotobel : "",
        formulaSantaTereza: (dataAtual && dataAtual.formulaSantaTereza) ? dataAtual.formulaSantaTereza : "",
      };
  
      setButtonLoading(btn, false);
  
      showModal(
        "Confirmar Movimenta√ß√£o",
        formatarConfirmacaoMov(saldosParaCalculo, deltas),
  
        async () => {
          try {
            setStatus("Gravando altera√ß√£o...", "muted", "spinner fa-spin");
            setButtonLoading(btn, true);
  
            const payload = {
              ...base,
              ...deltas,
              dataInicial: base.dataInicial,
              dataConcurso: base.dataConcurso
            };
  
            const res = await callApi("movimentar", payload);
            setButtonLoading(btn, false);
  
            if (res && res.ok) {
              setStatus("Planilha atualizada!", "ok", "check-double");
              clearMov();
            } else {
              setStatus((res && res.message) ? res.message : "Erro ao gravar.", "err", "exclamation-circle");
            }
          } catch (e) {
            setButtonLoading(btn, false);
            setStatus(e.message || String(e), "err", "exclamation-circle");
          }
        },
  
        () => {
          setButtonLoading(btn, false);
          setStatus("Movimenta√ß√£o cancelada.", "muted", "ban");
        }
      );
  
    } catch (err) {
      setButtonLoading(btn, false);
      setStatus(err.message || String(err), "err", "exclamation-circle");
    }
  }
  
  
  async function buscarControle() {
    const p = validateBuscarControle(); // ‚úÖ s√≥ o triplo + origem
    const btn = $("btnBuscarControle");
    
    setStatus("Buscando no sistema...", "muted", "spinner fa-spin");
    setButtonLoading(btn, true);
  
    try {
      const res = await callApi("buscarControle", p);
      setButtonLoading(btn, false);
  
      if (res && res.ok) {
        // ‚úÖ CASO ENCONTRADO: Mostra os dados que est√£o na planilha
        const texto = formatarPopupControle(res.data);
        showModal("üîç Dados Encontrados", texto, null);
        setStatus("Busca conclu√≠da.", "ok", "check");
      } else {
        // ‚ùå CASO N√ÉO ENCONTRADO: Mostra o "espelho" do que foi digitado
        const textoErro = formatarNaoEncontrado(p);
        showModal("‚ö†Ô∏è Aten√ß√£o", textoErro, null);
        setStatus("Bol√£o n√£o localizado.", "muted", "info-circle");
      }
    } catch (err) {
      setButtonLoading(btn, false);
      setStatus("Erro: " + err.message, "err", "exclamation-triangle");
    }
  }
// Fun√ß√£o auxiliar para montar o HTML de consulta limpo
function gerarHtmlConsultaUnica(d) {
  const lojas = ["Boulevard", "Centro", "Lotobel", "Santa Tereza"];
  let listaSaldos = "";

  lojas.forEach(l => {
    const campo = "qtd" + l.replace(" ", "");
    const saldo = d[campo] || 0;
    listaSaldos += `
      <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #f0f0f0; align-items:center;">
        <span style="font-weight:bold; color:#555;">${l}</span>
        <span style="font-size:16px; color:var(--txt); font-weight:700;">${saldo} <small style="font-weight:normal; font-size:11px; color:#888;">cotas</small></span>
      </div>`;
  });

  return `
    <div style="width:100%; max-width:320px; margin:0 auto;">
      <div style="background:#fdfdfd; border:1px solid #eee; border-radius:10px; margin-bottom:15px; overflow:hidden;">
        ${listaSaldos}
      </div>
      <button onclick="closeModal()" style="width:100%; padding:14px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-size:15px;">FECHAR</button>
    </div>`;
}
function formatarPopupControle(data) {
  // Fun√ß√£o auxiliar para montar a linha com aviso de m√∫ltiplos registros
  const montarLinha = (label, valor, count) => {
    let aviso = count > 1 ? ` ‚ö†Ô∏è (${count} registros)` : "";
    return `${label}: ${valor}${aviso}`;
  };

  return [
    `üìç Origem: ${data.origem}`,
    `üéØ Modalidade: ${data.modalidade}`,
    `# Concurso: ${data.concurso}`,
    `üóìÔ∏è In√≠cio: ${formatDateBR(data.dtInicial)}`,
    `üéüÔ∏è Concurso: ${formatDateBR(data.dtConcurso)}`,
    `üí∞ Cota: R$ ${data.valorCota.toFixed(2).replace(".", ",")}`,
    ``,
    `üéØ Quantidade de cotas por destino:`,
    montarLinha("  üè¢ Boulevard", data.qtdBoulevard, data.countBoulevard),
    montarLinha("  üè¨ Centro", data.qtdCentro, data.countCentro),
    montarLinha("  üè™ Lotobel", data.qtdLotobel, data.countLotobel),
    montarLinha("  üè† Santa Tereza", data.qtdSantaTereza, data.countSantaTereza),
    ``,
    `üïì √öltima altera√ß√£o: ${formatDateTimeBR(data.carimbo)}`
  ].join("\n");
}
    
function formatarConfirmacaoMov(data, deltas) {
  return [
    `üìç Origem: ${data.origem}`,
    `üéØ Modalidade: ${data.modalidade}`,
    `# Concurso: ${data.concurso}`,
    `üóìÔ∏è In√≠cio: ${formatDateBR(data.dtInicial)}`,
    `üéüÔ∏è Concurso: ${formatDateBR(data.dtConcurso)}`,
    `üí∞ Cota: R$ ${Number(data.valorCota||0).toFixed(2).replace(".", ",")}`,
    ``,
    `üìä CONFER√äNCIA DE MOVIMENTA√á√ÉO:`,
    `(Express√£o [Mov] ‚ûî Final)`,
    montarLinhaCalculo("  üè¢ Boulevard",    data.qtdBoulevard,    data.formulaBoulevard,    deltas.deltaBoulevard),
    montarLinhaCalculo("  üè¨ Centro",       data.qtdCentro,       data.formulaCentro,       deltas.deltaCentro),
    montarLinhaCalculo("  üè™ Lotobel",      data.qtdLotobel,      data.formulaLotobel,      deltas.deltaLotobel),
    montarLinhaCalculo("  üè† Santa Tereza", data.qtdSantaTereza,  data.formulaSantaTereza,  deltas.deltaSantaTereza),
    ``,
    `‚ö†Ô∏è Confirma a atualiza√ß√£o desses valores?`
  ].join("\n");
}

 function formatarNaoEncontrado(p) {
  const linhas = [
    `‚ùå BOL√ÉO N√ÉO ENCONTRADO`,
    `--------------------------------------`,
    `Verifique se os dados abaixo est√£o corretos:`,
    ``,
    `üìç Origem: ${p.lojaOrigem}`,
    `üéØ Modalidade: ${p.modalidade}`,
    `# Concurso: ${p.concurso}`
  ];

  // ‚úÖ datas primeiro (se existirem)
  if (p.dataInicial || p.dataConcurso) {
    linhas.push(`üóìÔ∏è In√≠cio (form): ${formatDateBR(p.dataInicial)}`);
    linhas.push(`üéüÔ∏è Concurso (form): ${formatDateBR(p.dataConcurso)}`);
  }

  // ‚úÖ valor da cota depois
  linhas.push(`üí∞ Cota: ${fmtBRL(p.valorCota)}`);
  linhas.push(``);
  linhas.push(`üí° Se estiver certo, este bol√£o ainda n√£o existe na planilha (vai aparecer ao cadastrar ou na primeira movimenta√ß√£o).`);

  return linhas.join("\n");
}

function formatDateTimeBR(dateStr) {
  if (!dateStr) return "-";
  const d = new Date(dateStr);
  if (isNaN(d)) return "-";

  const hh = String(d.getHours()).padStart(2, "0");
  const mm = String(d.getMinutes()).padStart(2, "0");
  return `${formatDateBR(dateStr)} ${hh}:${mm}`;
}

 function validateBase(exigirCotas = true) {
      const lojaOrigem = $("lojaOrigem").value.trim();
      const modalidade = $("modalidade").value.trim();
      const concurso = $("concurso").value.trim();

      const dataInicial = $("dataInicial").value;
      const dataConcurso = $("dataConcurso").value;

      const qtdJogos = Number(onlyDigits($("qtdJogos").value));
      const qtdDezenas = Number(onlyDigits($("qtdDezenas").value));

      const valorCota = parseBRMoneyToNumber($("valorCota").value);
      const cotas = Number(onlyDigits($("cotas").value));

      if (!lojaOrigem) throw new Error("Loja de origem √© obrigat√≥ria.");
      if (!modalidade) throw new Error("Modalidade √© obrigat√≥ria.");
      if (!concurso) throw new Error("Concurso √© obrigat√≥rio.");
      if (!dataInicial) throw new Error("Data inicial √© obrigat√≥ria.");
      if (!dataConcurso) throw new Error("Data do concurso √© obrigat√≥ria.");
      if (!qtdJogos || qtdJogos <= 0) throw new Error("Qtd de Jogos deve ser > 0.");
      if (!qtdDezenas || qtdDezenas <= 0) throw new Error("Qtd de Dezenas deve ser > 0.");
      if (!valorCota || valorCota <= 0) throw new Error("Valor da cota deve ser > 0.");
      if (exigirCotas && (!Number.isFinite(cotas) || cotas === 0)) throw new Error("Qtd de Cotas √© obrigat√≥ria (‚â† 0).");

      return { lojaOrigem, modalidade, concurso, dataInicial, dataConcurso, qtdJogos, qtdDezenas, valorCota, cotas };
    }
    
  function validateMov() {
  // usa a mesma base do cadastro, mas sem exigir cotas
  const base = validateBase(false);

  // cotas n√£o s√£o usadas no movimentar, mas o backend espera qtdJogos/qtdDezenas/datas
  return {
    lojaOrigem: base.lojaOrigem,
    modalidade: base.modalidade,
    concurso: base.concurso,
    dataInicial: base.dataInicial,
    dataConcurso: base.dataConcurso,
    qtdJogos: base.qtdJogos,
    qtdDezenas: base.qtdDezenas,
    valorCota: base.valorCota // ‚úÖ n√∫mero, est√°vel
  };
}
function validateBuscarControle() {
  const lojaOrigem = $("lojaOrigem").value.trim();
  const modalidade = $("modalidade").value.trim();
  const concurso   = $("concurso").value.replace(/[^\d]/g, "").trim();
  const valorCota  = parseBRMoneyToNumber($("valorCota").value); // number est√°vel

  // ‚úÖ obrigat√≥rios (para achar)
  if (!lojaOrigem) throw new Error("Loja de origem √© obrigat√≥ria.");
  if (!modalidade) throw new Error("Modalidade √© obrigat√≥ria.");
  if (!concurso)   throw new Error("Concurso √© obrigat√≥rio.");
  if (!valorCota || valorCota <= 0) throw new Error("Valor da cota deve ser > 0.");

  // ‚úÖ opcionais (s√≥ para exibir quando n√£o encontrar)
  const dataInicial = $("dataInicial").value || "";
  const dataConcurso = $("dataConcurso").value || "";

  return { lojaOrigem, modalidade, concurso, valorCota, dataInicial, dataConcurso };
}

async function consultarDadosPlanilha(base){
  // busca s√≥ o que o backend precisa
  const payload = {
    lojaOrigem: base.lojaOrigem,
    modalidade: base.modalidade,
    concurso: base.concurso,
    valorCota: base.valorCota,   // number est√°vel
    // datas opcionais s√≥ pra exibir se n√£o encontrar (voc√™ j√° quis isso)
    dataInicial: base.dataInicial || "",
    dataConcurso: base.dataConcurso || ""
  };

  const res = await callApi("buscarControle", payload);
  if (res && res.ok && res.data) return res.data;
  return null;
}


    function bind() {
      document.querySelectorAll("input,select").forEach(el => {
        el.addEventListener("change", saveDraft);
        el.addEventListener("keyup", saveDraft);
      });

      $("lojaOrigem").addEventListener("change", () => {
        updateThemeAndLogo();
        updateMovimentarUIByOrigem();
        refreshQuickbarForLoja();
        saveDraft();
      });

      document.querySelectorAll(".brand-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const loja = btn.getAttribute("data-loja");
          $("lojaOrigem").value = loja;
          updateThemeAndLogo();
          updateMovimentarUIByOrigem();
          refreshQuickbarForLoja();
          saveDraft();
        });
      });

      $("btnCadastrar").addEventListener("click", onCadastrar);
      $("btnDeletar").addEventListener("click", onDeletar);
      $("btnMovimentar").addEventListener("click", onMovimentar);

     $("btnLimpar").addEventListener("click", () => {
  clearFieldsExceptLoja();
  setStatus("Campos limpos (exceto loja).", "muted", "broom");
});


      $("btnZerarMov").addEventListener("click", () => {
        clearMov();
        setStatus("Movimenta√ß√£o limpa.", "muted", "broom");
      });

     $("modalidade").addEventListener("change", () => {
  const m = $("modalidade").value.trim();
  if (!m) return;

  const prev = localStorage.getItem("active_quick_mod") || "";

  if (prev !== m) {
    clearFieldsExceptLoja();      // limpa tudo
    $("modalidade").value = m;    // ‚úÖ rep√µe a modalidade escolhida
  }

  localStorage.setItem("active_quick_mod", m);
  setActiveModButton(m);
  renderChips(m);
  saveDraft();
});

}

    // Init
    loadDraft();
    bind();
    renderQuickbar();
    updateThemeAndLogo();
    updateMovimentarUIByOrigem();
    refreshQuickbarForLoja();

    
  </script>

  <!-- Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js");
      });
    }
  </script>
</body>
</html>
